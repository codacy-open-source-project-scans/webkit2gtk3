From 4d1f7f3d481476ce5a7ffc4980cc94536fee6588 Mon Sep 17 00:00:00 2001
From: Philippe Normand <philn@igalia.com>
Date: Wed, 15 Nov 2023 09:08:00 +0000
Subject: [PATCH] GStreamer: Bump to 1.22.7

---
 elements/components/gstreamer-plugins-good.bst | 1 +
 elements/include/gstreamer-source.yml          | 2 +-
 2 files changed, 2 insertions(+), 1 deletion(-)
 .../gstreamer/graceful-error-noopenh264.patch | 35 -------------------
 delete mode 100644 patches/gstreamer/graceful-error-noopenh264.patch

diff --git a/elements/components/gstreamer-plugins-good.bst b/elements/components/gstreamer-plugins-good.bst
index cea2a324..5d5224a7 100644
--- a/elements/components/gstreamer-plugins-good.bst
+++ b/elements/components/gstreamer-plugins-good.bst
@@ -45,6 +45,7 @@ variables:
     -Dtwolame=disabled
     -Dexamples=disabled
     -Drpicamsrc=disabled
+    -Dqt6=disabled
 
 public:
   cpe:
diff --git a/elements/include/gstreamer-source.yml b/elements/include/gstreamer-source.yml
index f36b91e..a5050cc 100644
--- a/elements/include/gstreamer-source.yml
+++ b/elements/include/gstreamer-source.yml
@@ -2,6 +2,6 @@ sources:
 - kind: git_repo
   url: freedesktop:gstreamer/gstreamer.git
   track: 1.*[02468].*
-  ref: 1.22.5-0-gbf6ce1d64a0697e7910826147b48f8f658366a5a
+  ref: 1.22.7-0-g4d13eddc8b6d3f42ba44682ba42048acf170547f
 - kind: patch_queue
   path: patches/gstreamer
diff --git a/patches/gstreamer/graceful-error-noopenh264.patch b/patches/gstreamer/graceful-error-noopenh264.patch
deleted file mode 100644
index 8fbe833..0000000
--- a/patches/gstreamer/graceful-error-noopenh264.patch
+++ /dev/null
@@ -1,35 +0,0 @@
-diff --git a/subprojects/gst-plugins-bad/ext/openh264/gstopenh264dec.cpp b/subprojects/gst-plugins-bad/ext/openh264/gstopenh264dec.cpp
-index e42dc093b7..06e92c15f4 100644
---- a/subprojects/gst-plugins-bad/ext/openh264/gstopenh264dec.cpp
-+++ b/subprojects/gst-plugins-bad/ext/openh264/gstopenh264dec.cpp
-@@ -162,7 +162,11 @@ gst_openh264dec_start (GstVideoDecoder * decoder)
-     WelsDestroyDecoder (openh264dec->decoder);
-     openh264dec->decoder = NULL;
-   }
--  WelsCreateDecoder (&(openh264dec->decoder));
-+
-+  if (WelsCreateDecoder (&(openh264dec->decoder)) != 0) {
-+    GST_DEBUG_OBJECT (openh264dec, "openh264dec_start, cannot create decoder");
-+    return 0;
-+  }
- 
- #ifndef GST_DISABLE_GST_DEBUG
-   {
-diff --git a/subprojects/gst-plugins-bad/ext/openh264/gstopenh264enc.cpp b/subprojects/gst-plugins-bad/ext/openh264/gstopenh264enc.cpp
-index 30af8e2677..b51d6e7fed 100644
---- a/subprojects/gst-plugins-bad/ext/openh264/gstopenh264enc.cpp
-+++ b/subprojects/gst-plugins-bad/ext/openh264/gstopenh264enc.cpp
-@@ -761,7 +761,12 @@ gst_openh264enc_set_format (GstVideoEncoder * encoder,
-     WelsDestroySVCEncoder (openh264enc->encoder);
-     openh264enc->encoder = NULL;
-   }
--  WelsCreateSVCEncoder (&openh264enc->encoder);
-+
-+  if (WelsCreateSVCEncoder (&openh264enc->encoder) != 0) {
-+    GST_ERROR_OBJECT (openh264enc, "openh264enc_set_format, cannot create encoder");
-+    return 0;
-+  }
-+
-   unsigned int uiTraceLevel = WELS_LOG_ERROR;
-   openh264enc->encoder->SetOption (ENCODER_OPTION_TRACE_LEVEL, &uiTraceLevel);
- 
-- 
2.41.0

