<!DOCTYPE html>
<html>
    <head>
        <title>
            Check that Credential Management parts of the API are not exposed by
            default
        </title>
    </head>
    <script>
        testRunner.dumpAsText();
        testRunner.waitUntilDone();

        if (window.navigator.credentials.requestIdentity !== undefined) {
            console.log("FAIL: requestIdentity() must not be exposed by default.");
        }

        if (window.DigitalCredential !== undefined) {
            console.log(
                "FAIL: DigitalCredential interface must not be exposed by default."
            );
        }

        window.internals.settings.setDigitalCredentialsEnabled(true);

        async function checkIFrame() {
            const iframeWin = document.querySelector("iframe").contentWindow;

            if (!iframeWin.navigator.credentials.requestIdentity) {
                console.log(
                    "FAIL: navigator.credentials.requestIdentity() must be exposed. Was enabled by pref."
                );
            }

            const isInstanceOfDigitalCredential =
                iframeWin.DigitalCredential.prototype instanceof
                iframeWin.Credential;
            if (!isInstanceOfDigitalCredential) {
                console.log(
                    "FAIL: DigitalCredential's prototype interface must be an instance of Credential."
                );
            }
            console.log("Test finished");
            testRunner.notifyDone();
        }
    </script>
    <body>
        <iframe src="about:blank" onload="checkIFrame()"></iframe>
    </body>
</html>
